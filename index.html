<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½é¥®æ°´åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e3f2fd, #e8f5e9);
            min-height: 100vh;
            padding: 10px;
            color: #2c3e50;
        }
        
        .app-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4fc3f7, #4db6ac);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .section {
            margin-bottom: 20px;
            background: #f8fdfa;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0f7fa;
            border-radius: 10px;
            font-size: 16px;
            background: #f0f8ff;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4fc3f7;
            background: white;
        }
        
        .btn {
            background: linear-gradient(135deg, #4fc3f7, #4db6ac);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            margin: 10px 0;
        }
        
        .recommendation {
            background: #e1f5fe;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 4px solid #4fc3f7;
        }
        
        .water-cup-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .water-cup {
            width: 120px;
            height: 150px;
            margin: 0 auto 15px;
            position: relative;
            border: 4px solid #4fc3f7;
            border-top: none;
            border-radius: 0 0 20px 20px;
            background: transparent;
            overflow: hidden;
        }
        
        .water-level {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #4db6ac, #81d4fa);
            transition: height 0.5s ease;
        }
        
        .cup-mouth {
            position: absolute;
            top: -8px;
            left: -2px;
            right: -2px;
            height: 8px;
            background: #4fc3f7;
            border-radius: 5px 5px 0 0;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #555;
        }
        
        .water-entries {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .entry-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #4db6ac;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .entry-time {
            font-size: 12px;
            color: #777;
        }
        
        .entry-amount {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .glass-btn {
            padding: 15px;
            background: #e1f5fe;
            border: 2px solid #b3e5fc;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
        }
        
        .glass-btn:hover {
            background: #4fc3f7;
            color: white;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #e3f2fd, #e8f5e9);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }
        
        .summary-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .summary-text {
            font-size: 14px;
            color: #777;
            margin-top: 5px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ğŸ’§ æ™ºèƒ½é¥®æ°´åŠ©æ‰‹</h1>
            <p>ç§‘å­¦é¥®æ°´ï¼Œå¥åº·ç”Ÿæ´»</p>
        </div>
        
        <div class="main-content">
            <!-- æ¨èé¥®æ°´é‡è®¾ç½® -->
            <div class="section">
                <div class="section-title">ğŸ“Š é¥®æ°´æ¨èè®¾ç½®</div>
                <div class="input-group">
                    <label for="weight">ä½“é‡ (kg)</label>
                    <input type="number" id="weight" placeholder="è¯·è¾“å…¥æ‚¨çš„ä½“é‡">
                </div>
                <button class="btn" onclick="calculateRecommendation()">
                    ğŸ”„ è®¡ç®—æ¨èé¥®æ°´é‡
                </button>
                <div class="recommendation" id="recommendation">
                    æ¨èæ¯æ—¥é¥®æ°´é‡ï¼š0 ml
                </div>
            </div>
            
            <!-- é¥®æ°´é‡è¿½è¸ª -->
            <div class="section">
                <div class="section-title">ğŸ’§ ä»Šæ—¥é¥®æ°´è¿½è¸ª</div>
                
                <div class="water-cup-container">
                    <div class="water-cup">
                        <div class="cup-mouth"></div>
                        <div class="water-level" id="waterLevel" style="height: 0%;"></div>
                    </div>
                    <div class="stats">
                        <span>å·²é¥®ï¼š<span id="currentAmount">0</span> ml</span>
                        <span>ç›®æ ‡ï¼š<span id="targetAmount">0</span> ml</span>
                        <span>å®Œæˆï¼š<span id="completionRate">0</span>%</span>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <div class="glass-btn" onclick="addWater(100)">100ml</div>
                    <div class="glass-btn" onclick="addWater(200)">200ml</div>
                    <div class="glass-btn" onclick="addWater(300)">300ml</div>
                </div>
                
                <div class="input-group">
                    <label for="customAmount">è‡ªå®šä¹‰é¥®æ°´é‡ (ml)</label>
                    <input type="number" id="customAmount" placeholder="è¾“å…¥é¥®æ°´é‡" value="250">
                </div>
                <button class="btn" onclick="addCustomWater()">
                    â• æ·»åŠ é¥®æ°´è®°å½•
                </button>
            </div>
            
            <!-- é¥®æ°´è®°å½• -->
            <div class="section">
                <div class="section-title">ğŸ“ é¥®æ°´è®°å½•</div>
                <div class="water-entries" id="waterEntries">
                    <div style="text-align: center; color: #999; padding: 20px;">æš‚æ— é¥®æ°´è®°å½•</div>
                </div>
            </div>
            
            <!-- ç»Ÿè®¡æ‘˜è¦ -->
            <div class="summary-card">
                <div class="summary-number" id="totalToday">0</div>
                <div class="summary-text">ä»Šæ—¥æ€»é¥®æ°´é‡ (ml)</div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">æ•°æ®å·²è‡ªåŠ¨ä¿å­˜</div>

    <script>
        // å­˜å‚¨é”®å
        const STORAGE_KEY = 'water_app_data_v2';

        // åº”ç”¨çŠ¶æ€
        let state = {
            targetAmount: 0,
            currentAmount: 0,
            entries: [],
            weight: 65
        };

        // ä» localStorage åŠ è½½æ•°æ®
        function loadFromStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // åªä¿ç•™ä»Šå¤©çš„è®°å½•ï¼ˆç®€åŒ–é€»è¾‘ï¼‰
                    const today = new Date().toISOString().split('T')[0];
                    state = {
                        ...parsed,
                        entries: parsed.entries.filter(entry => entry.date === today)
                    };
                    // é‡æ–°è®¡ç®—ä»Šæ—¥æ€»é‡
                    state.currentAmount = state.entries.reduce((sum, e) => sum + e.amount, 0);
                } else {
                    // é¦–æ¬¡ä½¿ç”¨é»˜è®¤å€¼
                    state.weight = 65;
                    calculateRecommendation();
                }
            } catch (e) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥', e);
            }
        }

        // ä¿å­˜åˆ° localStorage
        function saveToStorage() {
            try {
                // æ¸…ç†æ—§æ•°æ®ï¼ˆå¯é€‰ï¼šä¿ç•™æœ€è¿‘7å¤©ï¼‰
                const now = new Date();
                const cutoffDate = new Date(now.setDate(now.getDate() - 7)).toISOString().split('T')[0];
                const recentEntries = state.entries.filter(e => e.date >= cutoffDate);
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify({
                    targetAmount: state.targetAmount,
                    weight: state.weight,
                    entries: recentEntries
                }));
                
                // æ˜¾ç¤ºæç¤º
                showToast();
            } catch (e) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥', e);
            }
        }

        // æ˜¾ç¤ºä¿å­˜æç¤º
        function showToast() {
            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 1500);
        }

        // è®¡ç®—æ¨èé¥®æ°´é‡
        function calculateRecommendation() {
            const weightInput = document.getElementById('weight');
            const weight = parseFloat(weightInput.value) || state.weight;
            if (weight <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½“é‡');
                return;
            }
            
            state.weight = weight;
            const recommendation = Math.round(weight * 30);
            state.targetAmount = recommendation;
            
            document.getElementById('recommendation').innerHTML = 
                `æ¨èæ¯æ—¥é¥®æ°´é‡ï¼š${recommendation} ml<br>(${Math.round(recommendation / 250)} æ¯ 250ml)`;
            
            updateDisplay();
            saveToStorage();
        }

        // æ·»åŠ é¥®æ°´è®°å½•
        function addWater(amount) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            const dateStr = now.toISOString().split('T')[0];
            
            state.currentAmount += amount;
            state.entries.unshift({
                time: timeString,
                amount: amount,
                date: dateStr
            });
            
            updateDisplay();
            saveToStorage();
        }

        // æ·»åŠ è‡ªå®šä¹‰é¥®æ°´é‡
        function addCustomWater() {
            const customAmount = parseInt(document.getElementById('customAmount').value) || 0;
            if (customAmount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é¥®æ°´é‡');
                return;
            }
            addWater(customAmount);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const progress = state.targetAmount > 0 ? Math.min(100, (state.currentAmount / state.targetAmount) * 100) : 0;
            document.getElementById('waterLevel').style.height = `${progress}%`;
            document.getElementById('currentAmount').textContent = state.currentAmount;
            document.getElementById('targetAmount').textContent = state.targetAmount;
            document.getElementById('completionRate').textContent = Math.round(progress);
            document.getElementById('totalToday').textContent = state.currentAmount;
            
            // æ›´æ–°ä½“é‡è¾“å…¥æ¡†
            document.getElementById('weight').value = state.weight;
            
            // æ›´æ–°è®°å½•åˆ—è¡¨
            const entriesContainer = document.getElementById('waterEntries');
            if (state.entries.length === 0) {
                entriesContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— é¥®æ°´è®°å½•</div>';
            } else {
                entriesContainer.innerHTML = '';
                state.entries.forEach(entry => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'entry-item';
                    entryElement.innerHTML = `
                        <div>
                            <div class="entry-amount">${entry.amount} ml</div>
                            <div class="entry-time">${entry.time}</div>
                        </div>
                        <div>ğŸ’§</div>
                    `;
                    entriesContainer.appendChild(entryElement);
                });
            }
        }

        // åˆå§‹åŒ–
        function initApp() {
            loadFromStorage();
            updateDisplay();
        }

        // é¡µé¢åŠ è½½
        window.onload = initApp;
    </script>
</body>
</html>
